<!DOCTYPE html>
<html>

<head>
  <title>Causal inference in high dimensions</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <link rel="stylesheet" href="fonts/quadon/quadon.css">
  <link rel="stylesheet" href="fonts/gentona/gentona.css">
  <link rel="stylesheet" href="slides_style_i.css">
  <script type="text/javascript" src="assets/plotly/plotly-latest.min.js"></script>
</head>

<body>
  <textarea id="source">



<!-- TODO add slide numbers & maybe slide name -->

### Causal inference and the problem of batch effects

![:scale 40%](images/neurodata_blue.png)

Eric W. Bridgeford &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | {Biostatistics, BME, CIS}<br>
[ericwb95@gmail.com](mailto:ericwb95 at gmail dot com)  | [ericwb.me](https://ericwb.me)

---
name:talk

### Outline

- [Motivation and background](#back)
- [Notation](#theory)
- [Batch effect detection](#detect)
- [Batch effect removal](#removal)
- [Results](#results)
- [Discussion](#disc)

### [Additional Content](#extra)

---

name:back

### Outline

- Motivation and background
- [Notation](#theory)
- [Batch effect detection](#detect)
- [Batch effect removal](#removal)
- [Results](#results)
- [Discussion](#disc)

### [Additional Content](#extra)

---


### Typical problem in causal inference

<center>![:scale 60%](images/defense/causal1.png)</center>

- goal: estimate impact of an exposure (smoking) on measurements (cancer), given a set of covariates (ages)

---


### Problem 1: Unmeasured variables


<center>![:scale 60%](images/defense/causal2.png)</center>

- what if we didn't measure BMI, but BMI causes cancer and is related to smoking?

---

### Solution 1


<center>![:scale 60%](images/defense/causal3.png)</center>

- Assume unmeasured variables are minimally impactful

---

### Problem 2


<center>![:scale 60%](images/causal/causal_ex.png)</center>

- Measured: old smokers, and young non-smokers
  - did the smoking cause the cancer, or is cancer just a function of aging?
  - Technical term: .ye[Confounding]

---

### The problem of batch effects

- .ye[batch effect]: the impact of the data collection procedure (measurement device, measurement protocol, season, etc.) on the data collected
- .ye[demographic effect]: impact on the data of scientifically "interesting" characteristics of the object under study
- When datasets are demographically diverse (high confounding) and measurements are large (high number of features), difficult to <tagname style="color:red">mitigate batch effects</tagname> while <tagname style="color:green;">preserving demographic effects</tagname>

---

### DAG for a neuroimaging study

<center>![:scale 100%](images/causal/CoRR_DAG.png)</center>

---

### Existing work (detection)

- classical causal inference focuses on this problem for univariate measurements (e.g., smoking)
- some work (causal structure learning, conditional independence testing) attempts to do this in multivariate regimes

---

### Existing work (detection)

##### Conditional Independence (CI) testing

- focus on the problem of determining whether two variables are not (causally) related more than the problem of determing whether two variables are (causally) related
  - establishing causality is difficult (need more assumptions)

---

### Existing work (correction)

- ComBat (Johnson 2007)
  - fit a linear model, where individual "batches" are a linear transformation of one another
  - optional: "adjust" with terms for covariates (e.g., age, sex)

--
- Surrogate Variable Analysis (SVA, Leek 2007/2014)
  - use latent variable models to capture sources of batch heterogeneity

--
- NeuroHarmonize (Pomponio 2020)
  - estimate covariate relationships with Generalized Additive Models (GAMs)

---


### How do we propose to address batch effects?

- skip to latent variable modelling (e.g., SVA)?
- focus on estimation with linear/non-linear models (e.g., ComBat, NeuroHarmonize)?

Proposal: leverage techniques from .ye[causal inference] to yield strategies which are both theoretically and empirically sensible for batch effect analyses
- develop suitable language and estimands which allow us to be .ye[precise] when referring to batch effects

---

### Motivating questions

- how do we formulate batch effects as a problem in causal inference?
- how do we detect batch effects for more than two groups?
- under what assumptions are existing techniques to estimate batch effects reasonable?
- how robust are these techniques to confounding?
- what happens if the relationships are .ye[complicated] and there is confounding?

---

name:theory

### Outline

- [Motivation and background](#back)
- Notation
- [Batch effect detection](#detect)
- [Batch effect removal](#removal)
- [Results](#results)
- [Discussion](#disc)

### [Additional Content](#extra)

---


### General notation

| Symbol | Interpretation |
| --- | --- |
| $U$ | random variable |
| $u$ | realization of random variable $U$ |
| $F\_{U \vert v}$ | distribution of $U$ conditional on $V = v$ |
| $f\_{U \vert v}(u)$ | density of $u$ conditional on $V = v$ |
| $P\_{U \vert v}(u)$ | probability of $U = u$ conditional on $V = v$ |

---

### Specific notation

| Symbol | Interpretation |
| --- | --- |
| $Y_i$ | random variable representing an outcome |
| $T_i$ | random nominal ($1$ of $K$) exposure |
| $X_i$ | random variable representing measured covariates |
| $Z_i$ | random variable representing unmeasured covariates |
| $Y_i(t)$ | potential outcome under exposure $t$ |

---

name:detect

### Outline

- [Motivation and background](#back)
- [Notation](#theory)
- Batch effect detection
- [Batch effect removal](#removal)
- [Results](#results)
- [Discussion](#disc)

### [Additional Content](#extra)

---

### Causal  discrepancy

Let $ F\_{Y\_i\(t\)| x, z}$ denote the potential outcome distribution, conditional on the measured .ye[and] unmeasured covariates
  - distribution we would expect in exposure $t$ for an individual $i$ with covariates $(x, z)$
$$\forall t \in [K]:\;\;\;\;f\_{Y\_i(t)}(y) = \int\_{\mathcal X, \mathcal Z} f\_{Y\_i\(t\)| x, z}(y) f(x,z) d(x,z)$$

for two exposures $k$ and $l$, there is a .ye[causal discrepancy] if:

$$F\_{Y\_i(k)} \neq F\_{Y\_i(l)}$$

--
- idea: potential outcomes (e.g., connectomes) for an individual differ in exposures (e.g., batches) $k$ and $l$
- "batch effect"

---

### Observational studies and causality

- .ye[observational study]: exposure is not controlled directly by the experimenters
  - $Y_i$ and $Y_i(t)$ do not, in general, have similar conditional/unconditional distributions

--
- problem: sensible definition of a batch effect relies on potential outcomes $Y_i(t)$

--
- what other estimands "might" people discuss?

---

### Associational effects

- observe $(y_i, t_i)$ for $i \in [n]$

Associational effect exists between groups $k$ and $l$ if:
$$F\_{Y\_i \vert k} \neq F_{Y\_i \vert l}$$

--
- Causal if measured and unmeasured covariates ($X$ and $Z$) are .ye[non-confounding] (unconditional ignorability and overlap)
- difficult to argue in observational studies
  - if exposure groups (e.g., batches) fundamentally differ at all then not causal
---

### Problem with associational effects


<center>![:scale 60%](images/causal/ass_fail.png)</center>

- Propensity score overlap: $P\_{T\_i | x}(t) > 0$ for all $x, t$
  - "covariates cannot fully determine who is in which exposure"

---

### Conditional Effect

- Observe $\left(y_i, t_i, x_i\right)$ for all $i \in [n]$
 - $F_{Y\_i \vert t, x}$ is the .ye[observed] outcome distribution, conditional on the exposure (e.g., batch) and covariates $x$

Conditional effect exists between groups $k$ and $l$ if:
$$F\_{Y\_i \vert k, x} \neq F\_{Y\_i \vert l, x}$$
- Causal if .ye[no unmeasured confounding] (ignorability and overlap)
- most common estimands from observational data

---

### Causal Crossover Effect

- Observe $\left(y_i(t), x_i(t)\right)$ for all ${\color{yellow}{t \in [K]}}, i \in [n]$
- .ye[directly observe] outcomes for all exposures (batches)
$$F\_{Y\_i(k) | x(k)} \neq F\_{Y\_i(l) | x(l)}$$
- covariates $x(t)=$ traits/histories + States

--
- Traits/histories are constant to individuals, and therefore perfectly balanced across exposures by design

--
- States may be different, as they are functions of location & time
- $x(k)$ may be unequal to $x(l)$

---

### Detecting batch effects

- detection tends to be an easier problem than estimation
- Universally consistent tests readily exist for natural tests for non-causal effects in general settings (bounded variance)

.ye[implication]: don't need to limit the scope of distributions under consideration, nor the types of "differences" that can exist between exposures

---

### Detecting batch effects

##### Crossover
- states observed (or not) and constant/randomized: $\texttt{DCorr}$
- states observed and not constant/non-randomized: $\texttt{cDCorr}$
- .ye[usually not possible]

--

##### Associational
- $\texttt{DCorr}$
- requires extremely strong assumptions (almost always violated)

--

##### Conditional
- $\texttt{cDCorr}$
- no unmeasured confounding (possibly violated)
- overlap (usually violated in observational data)

---

### Overlap and batch effects (conditional)

<center>![:scale 60%](images/causal/ass_fail.png)</center>

- Overlap is a pre-hoc criterion: $P\_{T\_i | x}(t) > 0$ for all $x, t$
- "Approximate" overlap? Propensity trimming

---

### Vertex matching (VM)

- use generalized propensity score to "trim" individuals with low propensities for other exposures
  - generalizes well to $K \geq 2$ exposures

<center>![:scale 100%](images/causal/vm.png)</center>

- Causal $\texttt{cDCorr}$: prepend VM to $\texttt{cDCorr}$

---

### Simulations

- $n = 100$ samples
- $d=10$ (low dimensional) or $d=101$ (high dimensional)
- Settings: non-linear, non-monotone, second order, and multi-class non-linear true covariate/outcome relationship
- balance: how well do the covariates overlap?
- Effect size $\Delta$: how different is the data between batches?

<center>![:scale 100%](images/causal/Sigmoidal.png)</center>


---

% be more clear? 80/100? 
% make image larger??
% important????
% take more time

### Question 1: validity

- Fix $\Delta = 0$
- for all tests, varying balance from $0.2$ (low balance) to $1.0$ (complete balance):
  - estimate type I error rate over $r=100$ trials

--
- Valid test: Type I error rate $\approx \alpha = 0.05$

---

### Validity testing

<br/>


<center>![:scale 100%](images/causal/validity.png)</center>

- Causal cDCorr and KernelCDTest are only valid strategies
- Causal cDCorr only test which works on $>2$ exposure settings


---

### Question 2: power

- $H_A$ is true for $\Delta > 0$ (there is an effect)
- for all tests, vary $\Delta$ from $0$ to $1.0$ (outcome/covariate distributions very different across exposures):
  - estimate statistical power over $r=100$ trials

--
- Powerful test: statistical power increasing (to $\approx 1$) as $\Delta$ increases

---

### Power testing

<center>![:scale 100%](images/causal/Powers.png)</center>

- Causal $\texttt{cDCorr}$ is only approach powerful in all contexts

---

name:removal

### Outline

- [Motivation and background](#back)
- [Notation](#theory)
- [Batch effect detection](#detect)
- Batch effect removal
- [Results](#results)
- [Discussion](#disc)

### [Additional Content](#extra)

---

### Causal effect removal

A function $g$ removes the causal discrepancy between exposures $k$ and $l$ if:

$$F\_{Y\_i(k)} \neq F\_{Y\_i(l)}$$

and:

$$F\_{g(Y\_i(k))} = F\_{g(Y\_i(l))}$$

--

- idea: $g$ is a (usually unknown) function which "corrects" the disparity between potential outcomes

--
- "batch effect correction": estimating $g$ via $\hat g$

---

### Removing batch effects

##### Associational setting

- estimate $\hat g$ using $\left(y_i, t_i\right)$ for all $i \in [n]$

##### Conditional setting

- estimate $\hat g$ using $\left(y_i, t_i, x_i\right)$ for all $i \in [n]$

##### Crossover setting

- estimate $\hat g$ using $\left(y_i(t), x_i(t)\right)$ for all ${\color{yellow}{t \in [K]}}, i \in [n]$
- if states are changing, use conditional technique, else, associational

---

### Limitations of $\texttt{ComBat}$

$\texttt{cComBat}$: model "batch" as a linear transform of an "underlying" signal

$$y\_i = \alpha\_{t\_i} \left(f(x\_i) + \beta\_{t\_i}\right)$$
where $f$ is known

--
- estimate $\alpha\_{t\_i}$ and $\beta\_{t\_i}$ via regression approaches
- How critical is "knowing" $f$?

---

### Simulation

Let $\mathbb E[Y\_i(t) | x] = \beta_x f(x) + \beta_0\mathbb I(t = 2)$ be the "expected signal" for a covariate level $x$ in batch $t$

<center>![:scale 60%](images/causal/sim_simple.png)</center>


---

### Simulation

Sample $(t\_i, x\_i, \epsilon\_i)$ and let $y\_i = \mathbb E[Y(t\_i) | x\_i] + \epsilon_i$ for $n=200$ points

<center>![:scale 60%](images/causal/sim_simple2.png)</center>


---

### Simulation

Fit linear model, obtain estimate of $\beta_0$

<center>![:scale 60%](images/causal/sim_simple4.png)</center>

---

### Simulation

Let $\hat g(y, t) = y - \hat \beta_0 \mathbb I(t = 2)$
- Success: $\hat g\left(\mathbb E[Y\_i(2) | x\_i], 2\right) \approx \hat g\left(\mathbb E[Y\_i(1) | x\_i], 1\right)$

<center>![:scale 60%](images/causal/sim_simple5.png)</center>

---

### When we "guess" right, balance doesn't matter

<center>![:scale 90%](images/causal/correct_spec.png)</center>

- "Extrapolation" works just fine

---

### When we "guess" wrong, disaster

<center>![:scale 90%](images/causal/incorrect_spec.png)</center>

- $\texttt{ComBat}$ will (willingly and ablely) give us arbitrarily wrong answers
- "Extrapolation" works very not fine: batch effects are worse!

---

### When we "guess" wrong, disaster

- "Extrapolation" requires extreme confidence in our model
- when the number of outcome dimensions are high, how can we possibly expect to "guess" appropriate $f$ (for every dimension)?

--

##### (Possible) solutions
- nonparametric estimation of $f$ ($\texttt{NeuroHarm}$)
  - number of samples can be low; unclear how robust techniques (e.g., GAMs) are to HDLSS (high dimensionality; low sample size) problem

--
- Matching?

---

### Matching

- .ye[Goal]: equate the empirical propensity distributions between the two batches
- .ye[Implication]: improves robustness of estimates to model misspecification (Warnbaum 2012, VDV 1998)

<center>![:scale 90%](images/causal/matching.png)</center>

---

### When we "guess" wrong, stable

<center>![:scale 90%](images/causal/incorrect_spec_causal.png)</center>

- prepending "matching" yields stable estimates of batch effects
  - limited overlap: no information to do .ye[anything]

---

name:results

### Outline

- [Motivation and background](#back)
- [Notation](#theory)
- [Batch effect detection](#detect)
- [Batch effect removal](#removal)
- Results
- [Discussion](#disc)

### [Additional Content](#extra)

---

### CoRR Demographics


<center>![:scale 100%](images/causal/demographic.png)</center>

---

### Associational/conditional effects can almost always be estimated 

<center>![:scale 70%](images/causal/ass_eff.png)</center>

---

### Effects which respect confounding biases cannot

<center>![:scale 70%](images/causal/caus_eff.png)</center>

---

### Edge-wise analysis

- Effect of sex on connectivity (per edge), conditional on age

<center>![:scale 100%](images/causal/effect_size.png)</center>

- subsetting the data to demographically-aligned individuals, versus just demographically overlapping individuals, yields dramatically different inference

---

### Different assumptions produce radically different inference

<center>![:scale 100%](images/causal/edges.png)</center>

- upstream assumptions for batch effect correction play enormous role downstream

---

name:disc

### Outline

- [Motivation and background](#back)
- [Notation](#theory)
- [Batch effect detection](#detect)
- [Batch effect removal](#removal)
- [Results](#results)
- Discussion

### [Additional Content](#extra)

---

### Accomplishments (detection)

- developed new causal language and machinery for detection of causal effects in high-dimensional regimes
- demonstrated valid and powerful performance, unlike existing approaches (which often were neither)

##### Implications

- causal structure learning?
- causal discovery?
- large number of covariates?
- continuous exposures?
- $\texttt{VM}$ with ordinal exposures?

---

### Accomplishments (estimation)

- revised language for batch effects to be more precise and specific
  - provides theoretical support for past investigations of batch effects (e.g., Fortin 2018)
- simulations reveal substantial limitations of $\texttt{ComBat}$
  - uncover the benefits of causal perspective
- highlighted internal and external validity problems with neuroimaging
  - prioritizing internal validity yields dramatically different conclusions
- internal validity is a pre-req for external validity, so unclear the implications of non-causal protocols

---

### Limitations/Future work

- limited studies with high sample size and demographic overlap between batches
  - ABCD study (2021) "playground"
- can use these studies to directly investigate robustness (e.g., Fortin 2018)
  - split datasets into demographically non-aligned subsets; investigate stability
  - determine "best" batch effect correction protocols

##### Paths to check further

- strategies to overcome batch effects external post-hoc?
- HDLSS problem: difficult to work with high dimensionality and low samples
  - reduce model complexity: direct use of graph models with connectomes ($n \times n$ to $n \times d$)
  - GNNs? boosting strategies with GAMs (Mayr 2012)?

---

### Acknowledgements


<div class="small-container">
  <img src="faces/jovo.png"/>
  <div class="centered">Josh Vogelstein</div>
</div>
<div class="small-container">
  <img src="faces/powell.jpg"/>
  <div class="centered">Mike Powell</div>
</div>
<div class="small-container">
  <img src="faces/ting.jpeg"/>
  <div class="centered">Ting Xu</div>
</div>
<div class="small-container">
  <img src="faces/gkiar.jpg"/>
  <div class="centered">Greg Kiar</div>
</div>
<div class="small-container">
  <img src="faces/snoble.jpeg"/>
  <div class="centered">Stephanie Noble</div>
</div>
<div class="small-container">
  <img src="faces/bcaffo.jpg"/>
  <div class="centered">Brian Caffo</div>
</div>
<div class="small-container">
  <img src="faces/mm.jpg"/>
  <div class="centered">Michael Milham</div>
</div>
<div class="small-container">
  <img src="faces/jaewon.jpg"/>
  <div class="centered">J1 Chung</div>
</div>
<div class="small-container">
  <img src="faces/sambit.jpg"/>
  <div class="centered">Sambit Panda</div>
</div>
<div class="small-container">
  <img src="faces/ross.jpg"/>
  <div class="centered">Ross Lawrence</div>
</div>
<div class="small-container">
  <img src="faces/bgilbert.jpeg"/>
  <div class="centered">Brian Gilbert</div>
</div>
<div class="small-container">
  <img src="faces/cshen.jpg"/>
  <div class="centered">Cencheng Shen</div>
</div>
<div class="small-container">
  <img src="faces/abadea.jpeg"/>
  <div class="centered">Alexandra Badea</div>
</div>

<img src="images/funding/nsf_fpo.png" STYLE="HEIGHT:95px;"/>
<img src="images/funding/nih_fpo.png" STYLE="HEIGHT:95px;"/>
<img src="images/funding/darpa_fpo.png" STYLE=" HEIGHT:95px;"/>
<img src="images/funding/iarpa_fpo.jpg" STYLE="HEIGHT:95px;"/>
<img src="images/funding/KAVLI.jpg" STYLE="HEIGHT:95px;"/>
<img src="images/funding/schmidt.jpg" STYLE="HEIGHT:95px;"/>

- [Batch Effects (Bioarxiv)](https://www.biorxiv.org/content/10.1101/802629v8)
- [Causal effect detection (draft)](https://www.overleaf.com/read/vrmfvgnzyqzk)
- Code for [causal effect detection](https://github.com/ebridge2/cdcorr) and [batch effects paper](https://github.com/ebridge2/batch_effects)

---
name:extra

### [Outline](#talk)

### Additional Content

- [Theory](#deeptheory)
- [Extensions to unconditional effects](#uncond)
- [Simulations](#sims)
- [](#)

---
name:deeptheory

### [Outline](#talk)

### Additional Content

- Theory
- [Extensions to unconditional effects](#uncond)
- [Simulations](#sims)
- [](#)

---

### The average treatment effect

$\gamma \triangleq ATE = \mathbb E[Y_i(2) - Y_i(1)]$

$H_0 : \gamma = 0$ against $H_A : \gamma \neq 0$

- .ye[Fundamental problem of causal inference]: we observe $Y_i$, not $Y_i(t)$

---

### "Standard causal assumptions"


- Consistency: $Y_i = \\sum_t Y_i(t) \\mathbb I\\{T_i = t\\}$
  - we only observe one potential outcome (the rest are "missing")
--

- Positivity: $P(T_i  = t | X_i = x) > 0$ for all $x$
  - covariate distributions "overlap"
--

- Ignorability: $\left(Y_i(1), ..., Y_i(K)\right) \perp T_i | X_i$
  - missing data does not depend on missing data
  - Did we "observe" all impactful variables?
--

- No interference: treatments of units do not impact potential outcomes of other units

---

### Causal assumptions allow us to describe potential outcomes

Under standard causal assumptions, $\mathbb E[Y_i(t)] = \mathbb E\left[\mathbb E[Y_i | T_i = t, X_i]\right]$
  - uses: .ye[$G$-computation formula]
  - convenience: $\mathbb E[Y_i | T_i = 1, X_i]$ can be estimated

--

$\gamma \triangleq ATE = \mathbb E[Y_i(2) - Y_i(1)]$

$\Rightarrow \gamma = \mathbb E[\mathbb E[Y_i | T_i = 1, X_i] - \mathbb E[Y_i | T_i = 1, X_i]]$

---

### Simulated example

<center>![:scale 80%](images/causal/task.png)</center>

- assumption: age and malnutrition are the only factors that impact height

---

### Simulated example

<center>![:scale 80%](images/causal/data.png)</center>

- Causal assumptions?

---

### Simulated example

<center>![:scale 80%](images/causal/ate_ex_pos.png)</center>

- Run linear regression, look for offset
  - Offset "is" $\hat \gamma$

---

### "Unequal" impact across covariates?

<center>![:scale 80%](images/causal/cate_mot.png)</center>

---

### Conditional ATE

$\gamma_x \triangleq CATE(x) = \mathbb E[Y_i(2) - Y_i(1) | X = x]$

$H_0 : \gamma_x = 0$ against $H_A : \gamma_x \neq 0$

- Standard assumptions: $\mathbb E[Y_i(t) | X = x] = \mathbb E[Y_i | T_i = t, X = x]$ 
  - as before, can be estimated (and tested)

---

### "Unequal" impact across covariates?

<center>![:scale 80%](images/causal/cate_task.png)</center>
- problem: higher order moments?

---

### Causal conditional discrepancy

- .ye[Causal conditional discrepancy]:

$F\_{Y\_i(k) | x} \neq F\_{Y\_i(l) | x}$

- for two "exposures" $k$ and $l$, there is a "discrepancy" in the potential outcome distributions for some covariate level $x$

--
- problem: cannot determine from data (some potential outcomes $Y_i(t)$ are typically missing)

---

### Conditional discrepancy

.ye[Conditional discrepancy]:

$F\_{Y\_i | k, x} \neq F\_{Y\_i | l, x}$

- can determine from observed data (statements about observed $Y_i$)

--

##### Lemma

Under standard causal assumptions, the following two tests are equivalent:

1. $H\_0 : F\_{Y\_i(k) | x} = F\_{Y\_i(l) | x}$ against $H\_A: F\_{Y\_i(k) | x} \neq F\_{Y\_i(l) | x}$
2. $H\_0 : F\_{Y\_i | k, x} = F\_{Y\_i | l, x}$ against $H\_A: F\_{Y\_i | k, x} \neq F\_{Y\_i | l, x}$

--
- Tests for causal conditional conditional discrepancies are equivalent to conditional discrepancies

---

### Testing for causal discrepancies

Related: Conditional independence (CI) testing

$H\_0 : F\_{Y\_i, V\_i | x} = F\_{Y\_i | x}F\_{V\_i | x}$ against $H\_A : F\_{Y\_i, V\_i | x} \neq F\_{Y\_i | x}F\_{V\_i | x}$
- if $V\_i$ is nominal, this is a conditional discrepancy test

##### Remark (known)

If $V\_i$ is nominal, a CI test is equivalent to a conditional discrepancy test.

##### Corollary

Adding causal assumptions, a CI test is equivalent to a causal conditional discrepancy test.

---

### Causal assumptions in observational studies

- .ye[observational study]: variable under study is not controlled directly by the experimenters
  - e.g., who is malnourished vs adequately nourished

--
- consistency: is there only one exposure level?

--
- interference: domain expertise

---

### Ignorability in observational studies

- if we didn't measure all the variables, are they unimportant things like number of guitars owned...

<center>![:scale 60%](images/defense/causal3.png)</center>

---

### Ignorability in observational studies

- if we didn't measure all the variables, are they things like or important things like BMI?

<center>![:scale 60%](images/defense/causal5.png)</center>

- Down to domain expertise

---

### Positivity in observational studies

- Positivity/"overlap": are there areas of the covariate distribution that are .ye[impossible] to yield for some exposures?

<center>![:scale 60%](images/causal/positivity_viol.png)</center>

- Intuition: if we do not "see" outcomes for different exposure levels, it can only "hurt" us inferentially

---

### Positivity in observational studies

- Impossible to verify: condition about $P(T_i = t | X_i = x) > 0$
  - we can modify the data to .ye[approximate] positivity
- Vector matching: exclude covariate levels that are "impossible"
  - .ye[propensity trimming] to $K \geq 2$ groups

<center>![:scale 100%](images/causal/vm.png)</center>

---

### Proposed causal discrepancy test

- Prepend vector matching (VM) to conditional independence test (e.g., Conditional Distance Correlation) to yield a causal conditional discrepancy test

--

##### Known
1. Applies readily to high-dimensional data
2. Applies to multiple groups (lemma)
3. (Asymptotically) consistent test for causal conditional discrepancy testing (corollary)
  - works with .ye[enough] data

--

##### Unknown
  - Finite sample performance?
  - Impact of group imbalance on inference?
---



</textarea>
<!-- <script src="https://gnab.github.io/remark/downloads/remark-latest.min.js"></script> -->
<!-- <script src="remark-latest.min.js"></script> -->
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.3/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.3/contrib/auto-render.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.3/katex.min.css">
<script type="text/javascript">

  var options = {};
  var renderMath = function () {
    renderMathInElement(document.body);
    // or if you want to use $...$ for math,
    renderMathInElement(document.body, {
      delimiters: [ // mind the order of delimiters(!?)
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false },
        { left: "\\[", right: "\\]", display: true },
        { left: "\\(", right: "\\)", display: false },
      ]
    });
  }

  remark.macros.scale = function (percentage) {
    var url = this;
    return '<img src="' + url + '" style="width: ' + percentage + '" />';
  };

  // var slideshow = remark.create({
  // Set the slideshow display ratio
  // Default: '4:3'
  // Alternatives: '16:9', ...
  // {
  // ratio: '16:9',
  // });

  var slideshow = remark.create(options, renderMath);


</script>
</body>

</html>